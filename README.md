# SLinker

## Что это?

Автолинковщик для сайтов. Производит сбор и сохранение ключевых фраз и соответствующих страниц сайта, производит поиск их словоформ
в тексте или HTML, а также размещает ссылки на основе полученных результатов на страницы сайта.

* Учитывает минимальное расстояние между ссылками для избежания переспама. 
* При поиске фраз и их словоформ в тексте учитывает теги, в которых находятся найденные результаты (позволяет избегать установки ссылок в
  тегах a, head, table, textarea, button, h1, h2, h3 и т.п.).
* При поиске словоформ избегает слова не несущие смысловой нагрузки (такие как 'уже', 'или', 'быть', 'был', 'него', 'вас', 'нибудь', 'опять', 'вам', 'ведь' и другие).
* Имеется возможность предварительного удаления старых ссылок для удобной перелинковки сайта.
* Имеется возможность автоматической перелинковки большинства текстов на сайте с помощью модуля Opencart. Для других движков и CMS возможна доработка.
* Имеется возможность линковки текста POST запросом.


## Установка скриптов:

### Установка api на сайт

1. Скопировать в корень Вашего сайта папку /slinker
2. В папке /slinker/includes/config.php указать настройки подключения к базе данных в функции get_config(), а также указать логин и пароль для входа в админ панель

После этого будет доступна основная административная панель SLinker по адресу http://ВАШ_САЙТ/slinker
		
    
### Установка SLinker Textarea Processor

Перед тегом </body> добавить строку

```html
<script type="text/javascript" src="/slinker/js/textareaprocessor.js"></script>
```

Перед тегом </head> добавить строку

```html
<link href="/slinker/css/textareaprocessor.css" rel="stylesheet" />
```

Данный скрипт добавит всем тегам <textarea> панель для линковки сайта. Поддерживает summernote.js (не ниже v. 0.8.7)


### Установка модуля opencart

1. Установить api на сайт (см. выше)
2. Установить модуль из архива slinker.ocmod.zip:

Для версии 2.*

1. установить модуль slinker.ocmod.zip через админ панель с помощью "Установка расширений" (/admin/index.php?route=extension/installer&token=ВАШ_ТОКЕН)
    
Для версии 1.*:

1. разархивировать модуль slinker.ocmod.zip
2. скопировать содержимое папки upload в корень сайта
3. выполнить содержимое файла install.sql (например, с помощью phpmyadmin, adminer, dbforge и т.п.)
4. в файл /admin/view/template/common/header.tpl добавить перед тегом </head> строку

```html
<link href="/slinker/css/textareaprocessor.css" rel="stylesheet" />
```

5. в файл /admin/view/template/common/footer.tpl добавить перед тегом </body> строку

```html
<script type="text/javascript" src="/slinker/js/textareaprocessor.js"></script>
```

После этого будут доступны все функции SLinker в настройках модуля (/admin/index.php?route=module/slinker&token=ВАШ_ТОКЕН)


## Описание возможностей

### Основная административная панель.

Основная административная панель находится по адресу http://ВАШ_САЙТ/slinker, где доступны следующие страницы:

1. Линковщик html - производится поиск сохраненных фраз в тексте и линковка введенного текста или html кода
2. Сбор ключевых фраз - строится карта сайта, по которой производится парсинг мета тегов keywords, которые сохраняются в базу данных.
3. Сохраненные фразы - список сохраненных ключевых фраз и соответствующих страниц, которые используются для линковки текста. Нет возможности редактирования.
4. Различные демо страницы - демонстрируют работу разных компонентов системы: поисковый алгоритм, стеммер, построитель карты сайта. Используются для проверки качества работы алгоритмов.

### SLinker Textarea Processor.

Скрипт, который позволяет добавить панель линковщика для каждого текстового поля textarea на сайте. 
Вы можете установить его для административной панели для удобной линковки новых текстов на сайте. 
Поддерживает как обычные поля textarea, так и jQuery плагин summernote не ниже версии 0.8.7), который находится в архиве summernote-0.8.7-dist.zip.

### Модуль для Opencart.
Переносит административную панель SLinker в админку opencart. Включает в себя скрипт SLinker Textarea Processor, устанавливаемый для всей админ панели opencart.
Админ панель модуля включает в себя страницы:

1. Линковщик сайта - производится поиск сохраненных фраз в большинстве текстов на сайте, найденные фразы преобразуются в ссылки на соответствующие страницы.
2. Линковщик текста - производится поиск сохраненных фраз в введенном в соответствующее поле тексте, найденные фразы преобразуются в ссылки на соответствующие страницы.
3. Сбор ключевых фраз - строится карта сайта, по которой производится парсинг мета тегов keywords, которые сохраняются в базу данных.
4. Сохраненные фразы - список сохраненных ключевых фраз и соответствующих страниц, которые используются для линковки текста. Имеется возможность добавления и удаления фраз.

	
	
## Использование API.

Для линковки текста вы можете отправить POST запрос линковщику по адресу /slinker/ajax/link.php. 
Параметры:

* text - линкуемый текст (обязательный параметр)
* toskip - минимальное расстояние между ссылками (в символах)
* deletelinks - нужно ли предварительно удалить все ссылки в тексте (обрабатывается как boolean)
* path - полный url страницы, на которой будет размещен текст (позволяет избегать создания ссылок ведущих на ту же страницу)

Возвращает пролинкованный текст.
Пример использования с помощью JQuery:

```js
$.ajax({
	type: 'POST',
	url: '/slinker/ajax/link.php',
	data: 'text=' + text + '&toskip=' + toskip + '&deletelinks=' + deletelinks + '&path=' + path,
	success: function(data){
		if(data) {
			$('#slinker-result').val(data);
		}
	},
});
```

### Подключение SLinker API в PHP

Либо подключением файла boot.php:

```php
require_once("../slinker/includes/boot.php");
```

Либо подключением отдельных скриптов:	

```php
require_once("/slinker/includes/boot.php");
require_once("/slinker/includes/config.php");
require_once("/slinker/includes/templates.php");
require_once("/slinker/includes/database.php");
require_once("/slinker/includes/tools.php");
require_once("/slinker/includes/stemmer.php");
require_once("/slinker/includes/search.php");
require_once("/slinker/includes/callbacks.php");
require_once('/slinker/includes/libs/Smarty.class.php');
```

API представляет собой библиотеку функций. В каждом файле лежат различные части алгоритма

* database.php  - функции работы с БД (сохранение, удаление, редактирование ключевых фраз)
* config.php    - настройки поискового механизма, построителя карты сайта, доступы к БД
* templates.php - темизация элементов (страниц админ панели)
* tools.php     - вспомогательные функции и функции построителя карты сайта
* callbacks.php - callback функции админ панели (а по совместительству и функции-пример работы)
* stemmer.php   - функции стеммера
	
Пример. Для получения списка ключевых фраз и линковки текста используйте следующую конструкцию:

```php
$keyphrases = get_keyphrases(); // Получение списка ключевых фраз
$words = search_keyphrases_in_html($original_text, $keyphrases, $data['deletelinks']); // разбиение на слова и поиск ключевых фраз
$linked_text = search_create_text_from_words($words, $data['skiplen']);		// сборка текста в строку с размещением ссылок на месте найденных фраз
```

	

## Как использовать? Инструкция для Opencart.

Установить скрипт на сайт, описанным выше способом. Перейти в админ панель CMS Opencart. Перейти в настройки модуля SLinker:
Меню -> модули -> модули -> SLinker (Линковщик сайта) -> Настройки. Если модуль не активирован, то активировать его.

### Сбор ключевых фраз.

Для линковки требуется создать набор правил - список ключевых фраз и соответствующих им ссылок. Это можно сделать двумя способами:

1. автоматический сбор ключевых фраз;
2. ручное редактирование.

Автоматический сбор ключевых фраз доступен на соответствующей странице в настройках модуля (вкладка "Сбор ключевых фраз"). На данной странице
укажите домен сайта, который в дальнейшем Вы собираетесь линковать. По этому сайту будет построена карта сайта, произведется парсинг мета тегов и h1. 
Результаты будут сохранены в базу данных. Будте внимательны! После нажатия на кнопку сохранить (справа от заголовка с иконкой дискеты), ВСЕ имеющиеся 
правила (сохраненные фразы) будут предварительно удалены из базы, чтобы не дублировать записи.

Далее Вы можете просмотреть список сохраненных фраз на странице "Сохраненные фразы". На ней же доступны функции ручного редактирования. Вы можете удалить
ненужные фразы или добавить новые.

### Линковка сайта.

Линковка сайта производится двумя способами:

1. автоматическая линковка основных объектов сайта (полей описания категорий, товаров и т.п.)
2. ручная линковка текстов

Автоматическая линковка доступна на странице "Линковка сайта". Используйте пакетную линковку для больших сайтов для избежания таймаута. Укажите объекты
которые требуется обработать, а также укажите batch size - количество объектов, которые будут обработаны за итерацию (1 - 5 оптимальные параметры).

Ручная линковка одиночного текста выполняется либо на странице "Линковка текста" (копированием текста в поле, его обработкой, а затем копированием результата обратно),
либо с помощью скрипта SLinker Textarea Processor. Второй вариант удобнее. 

Скрипт SLinker Textarea Processor добавляет панель линковщика для каждого текстового поля textarea на сайте. Таким образом Вы можете перейти 
в настройки, например, категории, заполнить поле с текстом, а затем пролинковать его с помощью панели линковщика. В ней Вы должны указать 
требуется ли предварительно удалить	все ссылки (предпочтительнее для ПЕРЕлинковки), указать минимальное расстояние между размещаемыми 
ссылками (в символах), а также ссылку текущей страницы (полный url с доменом сайта), которая не будет добавляться в текст. После этого нажмите кнопку "Линковка текста".
Обработанный текст будет подставлен в редактируемое Вами поле textarea. Не забудьте сохранить изменения после линковки.
	


